<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Serve LLM Interceptor Overlay Preview</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      *, *::before, *::after {
        box-sizing: border-box;
      }

      :root {
        --accent: #1d4ed8;
        --accent-soft: rgba(29, 78, 216, 0.25);
        --muted: #475569;
        --subtle: #64748b;
        --panel: rgba(15, 23, 42, 0.72);
        --panel-border: rgba(148, 163, 184, 0.35);
        --bg: radial-gradient(circle at 20% 20%, #07172f, #020617 68%);
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      }

      body {
        margin: 0;
        min-height: 100vh;
        background: var(--bg);
        color: #e2e8f0;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 32px;
      }

      .demo-shell {
        width: min(1120px, 100%);
        display: grid;
        grid-template-columns: minmax(260px, 320px) 1fr;
        gap: 32px;
        background: rgba(15, 23, 42, 0.6);
        border: 1px solid rgba(148, 163, 184, 0.2);
        box-shadow: 0 30px 60px rgba(2, 6, 23, 0.55);
        border-radius: 24px;
        padding: 32px;
        backdrop-filter: blur(14px);
      }

      @media (max-width: 960px) {
        body {
          padding: 18px;
        }
        .demo-shell {
          grid-template-columns: 1fr;
          padding: 24px;
        }
      }

      .demo-description {
        margin-bottom: 24px;
        line-height: 1.6;
        color: rgba(226, 232, 240, 0.85);
      }

      .control-panel {
        background: var(--panel);
        border: 1px solid var(--panel-border);
        border-radius: 20px;
        padding: 24px;
        display: flex;
        flex-direction: column;
        gap: 18px;
      }

      .control-panel h1 {
        font-size: 1.3rem;
        margin: 0;
        color: #f8fafc;
      }

      .control-panel label {
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: rgba(226, 232, 240, 0.68);
      }

      .control-panel select,
      .control-panel button {
        appearance: none;
        font: inherit;
        font-size: 1rem;
        border: 1px solid rgba(148, 163, 184, 0.45);
        border-radius: 14px;
        padding: 12px 16px;
        background: rgba(15, 23, 42, 0.5);
        color: #e2e8f0;
        transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
      }

      .control-panel select:focus,
      .control-panel button:focus,
      .control-panel select:hover,
      .control-panel button:hover {
        border-color: rgba(96, 165, 250, 0.8);
        box-shadow: 0 8px 16px rgba(15, 23, 42, 0.45);
        outline: none;
      }

      .control-panel button {
        background: linear-gradient(135deg, rgba(96, 165, 250, 0.22), rgba(59, 130, 246, 0.3));
        cursor: pointer;
      }

      .control-panel .note {
        font-size: 0.86rem;
        line-height: 1.5;
        color: rgba(148, 163, 184, 0.85);
      }

      .preview-area {
        position: relative;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .overlay-stage {
        position: relative;
        width: min(720px, 100%);
        height: clamp(420px, 60vh, 520px);
        border-radius: 28px;
        background:
          radial-gradient(120% 140% at 10% 10%, rgba(37, 99, 235, 0.25), transparent 68%),
          radial-gradient(90% 110% at 90% 85%, rgba(96, 165, 250, 0.18), transparent 70%),
          rgba(2, 6, 23, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.2);
        overflow: hidden;
        box-shadow: inset 0 0 45px rgba(15, 23, 42, 0.6);
      }

      .overlay-grid {
        position: absolute;
        inset: 0;
        background: linear-gradient(rgba(148, 163, 184, 0.05) 1px, transparent 1px),
          linear-gradient(90deg, rgba(148, 163, 184, 0.05) 1px, transparent 1px);
        background-size: 60px 60px;
        opacity: 0.35;
        pointer-events: none;
      }

      [data-overlay] {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 24px;
        background: rgba(255, 255, 255, 0.08);
        transition: background 0.3s ease;
      }

      [data-overlay].effect-dvd-bounce {
        justify-content: flex-start;
        align-items: flex-start;
      }

      [data-wrapper] {
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        width: auto;
        height: auto;
        will-change: transform;
      }

      [data-overlay].effect-dvd-bounce [data-wrapper] {
        position: absolute;
        top: 0;
        left: 0;
      }

      .liquidGlass-wrapper {
        position: relative;
        overflow: hidden;
        box-shadow: 0 6px 6px rgba(0, 0, 0, 0.2), 0 0 20px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(148, 163, 184, 0.35);
        border-radius: 22px;
        min-width: 320px;
        max-width: 520px;
      }

      .liquidGlass-effect,
      .liquidGlass-tint,
      .liquidGlass-shine,
      .effect-ornament {
        position: absolute;
        inset: 0;
      }

      .liquidGlass-effect {
        z-index: 0;
        backdrop-filter: blur(7px);
        filter: url(#glass-distortion);
      }

      .liquidGlass-tint {
        z-index: 1;
        background: rgba(255, 255, 255, 0.5);
      }

      .liquidGlass-shine {
        z-index: 2;
        box-shadow:
          inset 2px 2px 1px 0 rgba(255, 255, 255, 0.5),
          inset -1px -1px 1px 1px rgba(255, 255, 255, 0.5);
      }

      .effect-ornament {
        z-index: 3;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .serve-llm-stage {
        position: relative;
        z-index: 4;
        display: grid;
        place-items: center;
        gap: 12px;
        text-align: center;
        max-width: 520px;
        padding: 24px 28px 28px;
      }

      .serve-llm-pulse {
        width: 96px;
        height: 96px;
        border-radius: 50%;
        background: radial-gradient(circle, rgba(29, 78, 216, 0.28), rgba(29, 78, 216, 0));
        display: grid;
        place-items: center;
        animation: serve-llm-pulse 2.4s ease-in-out infinite;
      }

      .serve-llm-spinner {
        width: 72px;
        height: 72px;
        border-radius: 50%;
        border: 6px solid rgba(29, 78, 216, 0.2);
        border-top-color: var(--accent);
        animation: serve-llm-spin 1.1s linear infinite;
      }

      .serve-llm-title {
        font: 600 1.1rem/1.3 system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
        color: #0f172a;
      }

      .serve-llm-status {
        font: 400 0.95rem/1.4 system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
        color: var(--muted);
        min-height: 1.2em;
      }

      .serve-llm-hint {
        font: 400 0.9rem/1.4 system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
        color: var(--subtle);
      }

      .mini-game {
        display: none;
        width: 200px;
        height: 72px;
        border-radius: 16px;
        background: rgba(15, 23, 42, 0.12);
        border: 1px solid rgba(148, 163, 184, 0.35);
        margin-top: 12px;
        position: relative;
        overflow: hidden;
      }

      .mini-game-court {
        position: absolute;
        inset: 12px;
        border-radius: 12px;
        border: 1px dashed rgba(59, 130, 246, 0.25);
      }

      .mini-game-ball {
        position: absolute;
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background: rgba(59, 130, 246, 0.95);
        box-shadow: 0 0 12px rgba(59, 130, 246, 0.75);
        animation: miniGameBall 3.4s ease-in-out infinite;
      }

      .mini-game-paddle {
        position: absolute;
        width: 34px;
        height: 6px;
        border-radius: 4px;
        background: rgba(148, 163, 184, 0.75);
      }

      .mini-game-paddle.left {
        left: 10px;
        animation: miniPaddleLeft 3.4s ease-in-out infinite;
      }

      .mini-game-paddle.right {
        right: 10px;
        animation: miniPaddleRight 3.4s ease-in-out infinite;
      }

      .orbiting-sparks {
        display: none;
      }

      .orbiting-sparks .spark {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 10px;
        height: 10px;
        margin: -5px;
        border-radius: 50%;
        background: rgba(59, 130, 246, 0.9);
        box-shadow: 0 0 12px rgba(59, 130, 246, 0.8);
        opacity: 0;
        transform-origin: 0 0;
      }

      .orbiting-sparks .spark-1 {
        --radius: 120px;
        --duration: 11s;
        background: rgba(56, 189, 248, 0.88);
      }

      .orbiting-sparks .spark-2 {
        --radius: 86px;
        --duration: 8s;
        background: rgba(29, 78, 216, 0.9);
      }

      .orbiting-sparks .spark-3 {
        --radius: 146px;
        --duration: 14s;
        background: rgba(165, 180, 252, 0.9);
      }

      @keyframes serve-llm-spin {
        to {
          transform: rotate(360deg);
        }
      }

      @keyframes serve-llm-pulse {
        0%, 100% {
          transform: scale(0.92);
          opacity: 0.6;
        }
        50% {
          transform: scale(1);
          opacity: 1;
        }
      }

      @keyframes dropMorph {
        0%, 100% {
          border-radius: 22px;
          transform: translate3d(0, 0, 0) scale(1);
        }
        25% {
          border-radius: 60px 80px 30px 90px / 40px 60px 28px 72px;
          transform: translate3d(0, -6px, 0) rotate(-1.5deg) scale(1.02);
        }
        50% {
          border-radius: 70px 35px 80px 30px / 70px 35px 65px 35px;
          transform: translate3d(0, 5px, 0) rotate(1.4deg) scale(0.98);
        }
        75% {
          border-radius: 32px 65px 28px 65px / 60px 34px 56px 34px;
          transform: translate3d(0, -3px, 0) rotate(-0.9deg) scale(1.01);
        }
      }

      @keyframes breathe {
        0%, 100% {
          transform: scale(0.92);
        }
        50% {
          transform: scale(1.02);
        }
      }

      @keyframes spinCycle {
        0%, 65% {
          transform: rotate(0deg);
        }
        70% {
          transform: rotate(360deg);
        }
        75% {
          transform: rotate(720deg);
        }
        76%, 100% {
          transform: rotate(0deg);
        }
      }

      @keyframes lanternSway {
        0%, 100% {
          transform: rotate(-1.4deg) translateY(-2px);
        }
        50% {
          transform: rotate(1.8deg) translateY(3px);
        }
      }

      @keyframes parallaxTilt {
        0%, 100% {
          transform: rotateX(0deg) rotateY(0deg) translateZ(0);
        }
        25% {
          transform: rotateX(3deg) rotateY(-3deg) translateZ(12px);
        }
        50% {
          transform: rotateX(-2deg) rotateY(3deg) translateZ(16px);
        }
        75% {
          transform: rotateX(2deg) rotateY(2deg) translateZ(8px);
        }
      }

      @keyframes parallaxGlow {
        0%, 100% {
          opacity: 1;
          transform: translate3d(0, 0, 0);
        }
        50% {
          opacity: 0.75;
          transform: translate3d(12px, -8px, 22px);
        }
      }

      @keyframes auroraFlow {
        0%, 100% {
          transform: translateX(-40%) skewX(-12deg);
        }
        50% {
          transform: translateX(40%) skewX(-6deg);
        }
      }

      @keyframes mellowWaves {
        0% {
          background-position: 0 0, 0 0;
        }
        100% {
          background-position: 200px 0, -150px 0;
        }
      }

      @keyframes orbit {
        0% {
          transform: rotate(0deg) translateX(var(--radius, 120px));
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        90% {
          opacity: 1;
        }
        100% {
          transform: rotate(360deg) translateX(var(--radius, 120px));
          opacity: 0;
        }
      }

      @keyframes miniGameBall {
        0% {
          left: 20px;
          top: 12px;
        }
        20% {
          left: calc(100% - 46px);
          top: 8px;
        }
        40% {
          left: calc(100% - 30px);
          top: calc(100% - 32px);
        }
        60% {
          left: 18px;
          top: calc(100% - 20px);
        }
        80% {
          left: calc(50% - 9px);
          top: calc(50% - 8px);
        }
        100% {
          left: 20px;
          top: 12px;
        }
      }

      @keyframes miniPaddleLeft {
        0%, 20% {
          top: calc(50% - 3px);
        }
        40% {
          top: calc(100% - 24px);
        }
        60% {
          top: 12px;
        }
        100% {
          top: calc(50% - 3px);
        }
      }

      @keyframes miniPaddleRight {
        0%, 40% {
          top: 12px;
        }
        60% {
          top: calc(100% - 24px);
        }
        100% {
          top: 14px;
        }
      }

      [data-overlay]::before,
      [data-overlay]::after {
        content: "";
        position: absolute;
        inset: 0;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
      }

      [data-overlay].effect-aurora-sweep::before {
        opacity: 0.55;
        background: linear-gradient(120deg, rgba(59, 130, 246, 0.35), rgba(56, 189, 248, 0.2), rgba(59, 130, 246, 0.35));
        mix-blend-mode: screen;
        filter: blur(40px);
        animation: auroraFlow 9s ease-in-out infinite;
      }

      [data-overlay].effect-chill-waves::after {
        opacity: 0.4;
        background:
          repeating-linear-gradient(90deg, rgba(59, 130, 246, 0.14) 0px, rgba(59, 130, 246, 0.14) 2px, transparent 2px, transparent 22px),
          repeating-linear-gradient(180deg, rgba(99, 102, 241, 0.12) 0px, rgba(99, 102, 241, 0.12) 3px, transparent 3px, transparent 26px);
        mask-image: linear-gradient(180deg, transparent 0%, rgba(0, 0, 0, 0.95) 28%, rgba(0, 0, 0, 0.95) 72%, transparent 100%);
        animation: mellowWaves 9s linear infinite;
      }

      .effect-wobble-drop [data-motion] {
        animation: dropMorph 3.4s ease-in-out infinite;
      }

      .effect-breathe [data-motion] {
        animation: breathe 7s ease-in-out infinite;
      }

      .effect-spin-cycle [data-motion] {
        animation: spinCycle 5s ease-in-out infinite;
        transform-origin: center;
      }

      .effect-mini-game .mini-game {
        display: block;
      }

      .effect-mini-game .serve-llm-hint {
        color: rgba(71, 85, 105, 0.7);
      }

      .effect-mini-game .serve-llm-pulse {
        animation-duration: 2s;
      }

      .effect-dvd-bounce [data-motion] {
        box-shadow: 0 18px 38px rgba(15, 23, 42, 0.55), 0 0 24px rgba(59, 130, 246, 0.18);
      }

      .effect-dvd-bounce .serve-llm-stage {
        padding: 22px 26px;
      }

      .effect-lantern-sway [data-motion] {
        transform-origin: top center;
        animation: lanternSway 6.6s ease-in-out infinite;
      }

      .effect-parallax-tilt [data-motion] {
        perspective: 1200px;
      }

      .effect-parallax-tilt .serve-llm-stage {
        transform-style: preserve-3d;
        animation: parallaxTilt 8.5s ease-in-out infinite;
      }

      .effect-parallax-tilt .liquidGlass-shine {
        animation: parallaxGlow 8.5s ease-in-out infinite;
      }

      .effect-parallax-tilt .serve-llm-spinner {
        animation-duration: 0.9s;
      }

      .effect-orbiting-sparks .effect-ornament {
        opacity: 1;
      }

      .effect-orbiting-sparks .orbiting-sparks {
        display: block;
      }

      .effect-orbiting-sparks .spark {
        animation: orbit var(--duration, 9s) linear infinite;
      }

      .effect-aurora-sweep .liquidGlass-wrapper {
        border-color: rgba(148, 197, 253, 0.5);
      }

      .effect-chill-waves [data-motion] {
        box-shadow: 0 24px 46px rgba(2, 135, 206, 0.22), 0 8px 18px rgba(15, 23, 42, 0.35);
      }

      .effect-chill-waves .serve-llm-stage {
        transform: translateY(4px);
      }

      .effect-chill-waves .serve-llm-hint {
        color: rgba(71, 85, 105, 0.88);
      }

      .effect-lantern-sway .serve-llm-hint,
      .effect-parallax-tilt .serve-llm-hint,
      .effect-breathe .serve-llm-hint {
        color: rgba(71, 85, 105, 0.82);
      }

      .effect-wobble-drop .serve-llm-hint {
        color: rgba(71, 85, 105, 0.78);
      }

      svg#distortion-source {
        position: absolute;
        width: 0;
        height: 0;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <div class="demo-shell">
      <section class="control-panel">
        <h1>Interceptor Overlay Playground</h1>
        <p class="demo-description">
          Preview the navigation interceptor overlay and audition animation ideas before shipping.
          Toggle different motion styles to see how they feel with the existing liquid glass treatment.
        </p>
        <div class="control-group">
          <label for="effect-select">Choose an effect</label>
          <select id="effect-select">
            <option value="none">None (default)</option>
            <option value="wobble-drop">Wobbly drop morph</option>
            <option value="dvd-bounce">DVD screensaver drift</option>
            <option value="breathe">Gentle breathe</option>
            <option value="spin-cycle">Spin cycle burst</option>
            <option value="mini-game">Mini rally (auto)</option>
            <option value="lantern-sway">Lantern sway</option>
            <option value="parallax-tilt">Parallax tilt</option>
            <option value="orbiting-sparks">Orbiting sparks</option>
            <option value="aurora-sweep">Aurora sweep</option>
            <option value="chill-waves">Chill waves</option>
          </select>
        </div>
        <button id="effect-random" type="button">Surprise me</button>
        <p class="note">
          Tip: resize the window or tap “Surprise me” repeatedly to get a feel for how the overlay reacts inside
          different viewports.
        </p>
      </section>
      <section class="preview-area">
        <div class="overlay-stage" data-arena>
          <div class="overlay-grid"></div>
          <div class="demo-overlay" data-overlay>
            <div class="overlay-anchor" data-wrapper>
              <div class="liquidGlass-wrapper" data-motion>
                <div class="effect-ornament orbiting-sparks" aria-hidden="true">
                  <span class="spark spark-1"></span>
                  <span class="spark spark-2"></span>
                  <span class="spark spark-3"></span>
                </div>
                <div class="liquidGlass-effect"></div>
                <div class="liquidGlass-tint"></div>
                <div class="liquidGlass-shine"></div>
                <div class="serve-llm-stage">
                  <div class="serve-llm-pulse">
                    <div class="serve-llm-spinner" role="status" aria-live="polite" aria-label="Generating the next view"></div>
                  </div>
                  <div class="serve-llm-title">Generating your next view</div>
                  <div class="serve-llm-status" data-status>Summoning your adaptive canvas…</div>
                  <div class="serve-llm-hint">Hold tight—we ask your configured model to compose a fresh canvas.</div>
                  <div class="mini-game" aria-hidden="true">
                    <div class="mini-game-court"></div>
                    <div class="mini-game-ball"></div>
                    <div class="mini-game-paddle left"></div>
                    <div class="mini-game-paddle right"></div>
                  </div>
                </div>
              </div>
            </div>
            <svg id="distortion-source">
              <filter id="glass-distortion" x="0%" y="0%" width="100%" height="100%" filterUnits="objectBoundingBox">
                <feTurbulence type="fractalNoise" baseFrequency="0.008 0.008" numOctaves="1" seed="12" result="turbulence"></feTurbulence>
                <feGaussianBlur in="turbulence" stdDeviation="5" result="softMap"></feGaussianBlur>
                <feSpecularLighting in="softMap" surfaceScale="3.5" specularConstant="0.9" specularExponent="85" lighting-color="white" result="specLight">
                  <fePointLight x="-160" y="-180" z="260"></fePointLight>
                </feSpecularLighting>
                <feComposite in="specLight" operator="arithmetic" k1="0" k2="1" k3="1" k4="0" result="litImage"></feComposite>
                <feDisplacementMap in="SourceGraphic" in2="softMap" scale="50" xChannelSelector="R" yChannelSelector="G"></feDisplacementMap>
              </filter>
            </svg>
          </div>
        </div>
      </section>
    </div>
    <script>
      (function () {
        const effects = [
          { id: 'wobble-drop', label: 'Wobbly drop morph' },
          { id: 'dvd-bounce', label: 'DVD screensaver drift' },
          { id: 'breathe', label: 'Gentle breathe' },
          { id: 'spin-cycle', label: 'Spin cycle burst' },
          { id: 'mini-game', label: 'Mini rally (auto)' },
          { id: 'lantern-sway', label: 'Lantern sway' },
          { id: 'parallax-tilt', label: 'Parallax tilt' },
          { id: 'orbiting-sparks', label: 'Orbiting sparks' },
          { id: 'aurora-sweep', label: 'Aurora sweep' },
          { id: 'chill-waves', label: 'Chill waves' }
        ];

        const overlay = document.querySelector('[data-overlay]');
        const arena = document.querySelector('[data-arena]');
        const wrapper = document.querySelector('[data-wrapper]');
        const motion = document.querySelector('[data-motion]');
        const statusTarget = document.querySelector('[data-status]');
        const select = document.getElementById('effect-select');
        const randomButton = document.getElementById('effect-random');
        const effectClasses = effects.map((effect) => 'effect-' + effect.id);

        const statuses = [
          'Reticulating creative splines',
          'Searching the web for inspo',
          'Sketching wireframes in thin air',
          'Procrastinating... productively',
          'Auditing color palettes against vibes',
          'Consulting the prompt whisperer',
          'Coaxing latent space into a moodboard',
          'Sampling temperature curves for witty tooltips',
          'Polishing edge cases in the instruction buffer'
        ];

        let statusIndex = 0;
        setInterval(() => {
          statusIndex = (statusIndex + 1) % statuses.length;
          if (statusTarget) statusTarget.textContent = statuses[statusIndex];
        }, 3400);

        let dvdRAF = null;
        let dvdLast = null;
        const dvdState = { x: 0, y: 0, vx: 0.22, vy: 0.18 };

        function stopDvdAnimation() {
          if (dvdRAF) cancelAnimationFrame(dvdRAF);
          dvdRAF = null;
          dvdLast = null;
          wrapper.style.transform = '';
        }

        function dvdFrame(timestamp) {
          if (!overlay.classList.contains('effect-dvd-bounce')) {
            stopDvdAnimation();
            return;
          }

          if (dvdLast === null) {
            dvdLast = timestamp;
            dvdRAF = requestAnimationFrame(dvdFrame);
            return;
          }

          const dt = timestamp - dvdLast;
          dvdLast = timestamp;

          const arenaRect = arena.getBoundingClientRect();
          const wrapWidth = motion.offsetWidth;
          const wrapHeight = motion.offsetHeight;
          const maxX = Math.max(arenaRect.width - wrapWidth, 0);
          const maxY = Math.max(arenaRect.height - wrapHeight, 0);

          dvdState.x += dvdState.vx * dt;
          dvdState.y += dvdState.vy * dt;

          if (dvdState.x <= 0) {
            dvdState.x = 0;
            dvdState.vx = Math.abs(dvdState.vx);
          } else if (dvdState.x >= maxX) {
            dvdState.x = maxX;
            dvdState.vx = -Math.abs(dvdState.vx);
          }

          if (dvdState.y <= 0) {
            dvdState.y = 0;
            dvdState.vy = Math.abs(dvdState.vy);
          } else if (dvdState.y >= maxY) {
            dvdState.y = maxY;
            dvdState.vy = -Math.abs(dvdState.vy);
          }

          wrapper.style.transform = 'translate3d(' + dvdState.x.toFixed(2) + 'px,' + dvdState.y.toFixed(2) + 'px,0)';
          dvdRAF = requestAnimationFrame(dvdFrame);
        }

        function startDvdAnimation() {
          const arenaRect = arena.getBoundingClientRect();
          const wrapWidth = motion.offsetWidth;
          const wrapHeight = motion.offsetHeight;

          dvdState.x = Math.max((arenaRect.width - wrapWidth) / 2, 0);
          dvdState.y = Math.max((arenaRect.height - wrapHeight) / 2, 0);
          dvdState.vx = (Math.random() > 0.5 ? 1 : -1) * (0.18 + Math.random() * 0.08);
          dvdState.vy = (Math.random() > 0.5 ? 1 : -1) * (0.16 + Math.random() * 0.07);
          dvdLast = null;
          wrapper.style.transform = 'translate3d(' + dvdState.x.toFixed(2) + 'px,' + dvdState.y.toFixed(2) + 'px,0)';
          dvdRAF = requestAnimationFrame(dvdFrame);
        }

        function setEffect(id) {
          overlay.classList.remove(...effectClasses);
          stopDvdAnimation();

          if (id && id !== 'none') {
            overlay.classList.add('effect-' + id);
            if (id === 'dvd-bounce') {
              startDvdAnimation();
            }
          }
          select.value = id || 'none';
        }

        select.addEventListener('change', (event) => {
          setEffect(event.target.value);
        });

        randomButton.addEventListener('click', () => {
          const pool = effects.map((effect) => effect.id);
          const randomId = pool[Math.floor(Math.random() * pool.length)];
          setEffect(randomId);
        });

        window.addEventListener('resize', () => {
          if (overlay.classList.contains('effect-dvd-bounce')) {
            startDvdAnimation();
          }
        });

        setEffect('none');
      })();
    </script>
  </body>
</html>
